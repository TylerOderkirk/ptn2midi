<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="ptn2midi : Export your Roland SP-404SX patterns and samples to MIDI and SoundFont files" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>ptn2midi</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/TylerOderkirk/ptn2midi">View on GitHub</a>

          <h1 id="project_title">ptn2midi</h1>
          <h2 id="project_tagline">Export your Roland SP-404SX patterns and samples to MIDI and SoundFont files</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/TylerOderkirk/ptn2midi/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/TylerOderkirk/ptn2midi/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h3>

<p>The Roland SP-404SX Sampler is well-made, portable, <em>and</em> it has a slick user interface. Unfortunately its samples and patterns are stored in an undocumented proprietary format on an SD card.</p>

<p>Until now, the only way to collaborate with other producers and Digital Audio Workstation ("DAW") users was to "play" a pattern on the sampler and record its line-out to a single stereo track. This eliminates the ability to apply per-sample effects and make fine-grained changes to the arrangement.</p>

<p>With the help of ModuLR's notes on <a href="http://sp-forums.com/">SP-FORUMS</a>, I've created a utility in Python called "ptn2midi" that translates a pattern on the SP-40SX's SD card to a MIDI (<code>.mid</code>) file and a SoundFont v1.2 (<code>.sf2</code>) file.</p>

<p>The MIDI file includes the note pitches, durations, and timing data. The SoundFont file contains the associated samples, trimmed, just as they were on the sampler itself.</p>

<h3>
<a name="how-to-use-the-utility" class="anchor" href="#how-to-use-the-utility"><span class="octicon octicon-link"></span></a>How to use the utility</h3>

<ol>
<li>Create a pattern on the SP-404SX. Store it, for example, on pad A1</li>
<li>Download and extract the ptn2midi repository from <a href="https://github.com/TylerOderkirk/ptn2midi/archive/master.zip">https://github.com/TylerOderkirk/ptn2midi/archive/master.zip</a>
</li>
<li>Install <a href="http://www.emergentmusics.org/midiutil">the MIDIUtil Python library</a>
</li>
<li>Insert the sampler's SD card into your computer and run the utility: <code>./ptn2midi.py /media/tz/SP-404SX/ A1 95</code> where the first argument is the path (with trailing delimiter) to the SD card, the second is the name of the pattern, and the third is the tempo</li>
<li>Load the resulting files e.g. <code>PTN_A1.mid</code> and <code>PTN_A1.sf2</code> into your DAW of choice</li>
</ol><h3>
<a name="demonstration" class="anchor" href="#demonstration"><span class="octicon octicon-link"></span></a>Demonstration</h3>

<p>I loaded the factory default samples and created a pattern at 95 BPM on pad F1. <a href="https://soundcloud.com/dj_toadstool/ptn-f1-roland-line-out-recorded">Here's a recording from the sampler's line-out</a>. Pay no mind to the clipping!</p>

<p><img src="https://raw.githubusercontent.com/TylerOderkirk/ptn2midi/gh-pages/images/playing_pattern_on_sp-404sx_imgflip_a0fwj.gif" alt="My sampler playing the pattern"></p>

<p>And... <a href="https://soundcloud.com/dj_toadstool/ptn-f1-ableton-export">here's what I got</a> when I created a new track in Ableton Live 9, imported the <code>.sf2</code> and <code>.mid</code> files from the utility, and did "Export audio/video".</p>

<p><img src="https://raw.githubusercontent.com/TylerOderkirk/ptn2midi/gh-pages/images/ableton_midi_note_editor.gif" alt="Ableton's MIDI note editor view"></p>

<p>This is a portion of the program's debugging output:</p>

<pre><code>[...]
Pad(start=512, end=91068, user_start=512, user_end=91068, volume=127, lofi=False, loop=False, gate=True, reverse=False, unknown1=1, channels=1, tempo_mode=0, tempo=1168, user_tempo=1168)
Pad(start=512, end=87612, user_start=512, user_end=87612, volume=127, lofi=False, loop=False, gate=True, reverse=False, unknown1=1, channels=1, tempo_mode=0, tempo=1215, user_tempo=1215)
Pad(start=512, end=83132, user_start=512, user_end=83132, volume=127, lofi=False, loop=False, gate=True, reverse=False, unknown1=1, channels=1, tempo_mode=0, tempo=1281, user_tempo=1281)
Pad(start=512, end=87872, user_start=512, user_end=87872, volume=127, lofi=False, loop=False, gate=True, reverse=False, unknown1=1, channels=1, tempo_mode=0, tempo=1211, user_tempo=1211)
[...]
Note(delay=144, pad=47, bank_switch=1, unknown2=0, velocity=127, unknown3=64, length=113)
Note(delay=144, pad=47, bank_switch=1, unknown2=0, velocity=127, unknown3=64, length=137)
Note(delay=96, pad=49, bank_switch=1, unknown2=0, velocity=127, unknown3=64, length=84)
Note(delay=136, pad=47, bank_switch=1, unknown2=0, velocity=127, unknown3=64, length=122)
[...]
pitch: 36 - /media/tz/SP-404SX/ROLAND/SP-404SX/SMPL/F0000001.WAV -&gt; /tmp/F0000001.WAV_mono.wav -&gt; template01.wav
pitch: 37 - /media/tz/SP-404SX/ROLAND/SP-404SX/SMPL/F0000003.WAV -&gt; /tmp/F0000003.WAV_mono.wav -&gt; template02.wav
pitch: 38 - /media/tz/SP-404SX/ROLAND/SP-404SX/SMPL/F0000002.WAV -&gt; /tmp/F0000002.WAV_mono.wav -&gt; template03.wav
[...]
</code></pre>

<h3>
<a name="how-it-works" class="anchor" href="#how-it-works"><span class="octicon octicon-link"></span></a>How it works</h3>

<ol>
<li>
<code>get_pad_info()</code> - The utility parses PAD_INFO.BIN from the SD card to determine the "start" and "end" points for every sample on the SD card. These points have been set
with the "Mark" button and "Start/End" feature on the sampler</li>
<li>
<code>get_pattern()</code> - The utility parses the .BIN file corresponding to the pattern to determine when, and for how long, each "note" in the pattern should be played</li>
<li>
<code>create_midi_file()</code> - The utility assigns a unique pitch (starting at C1[36]) to each sample used by the pattern, truncating each and converting it to a single channel (see "Future Improvements"), overwriting the WAVs of an included "template" SoundFont</li>
<li>
<code>create_soundfont()</code> - The utility assembles the samples and associated pitches into a SoundFont v2.1 (.sf2) file using pysf and a SoundFont descriptor named template.xml</li>
</ol><p><img src="https://raw.githubusercontent.com/TylerOderkirk/ptn2midi/gh-pages/images/sys_arch_print_preview.png" alt="System architecture diagram"></p>

<h3>
<a name="future-improvements" class="anchor" href="#future-improvements"><span class="octicon octicon-link"></span></a>Future Improvements:</h3>

<ol>
<li>Support more than 12 samples per pattern. Trivial - expand Template .xml</li>
<li>Support stereo samples. Trivial - assign two samples (left and right) per SoundFont pitch/note</li>
<li>Support AIF samples. Trivial - convert to PCM WAV intitially</li>
<li>Support "looped" samples. Use <code>&lt;loop&gt;</code> entries in <code>&lt;wavetable&gt;</code> nodes in <code>template.xml</code>? <code>create_looped_wav()</code>?</li>
<li>Support platforms other than Ubuntu Linux Saucy (13.10). Temporary file locations</li>
<li>Implement robust command-line argument parsing</li>
<li>Support other samplers in the Roland SP family</li>
<li>Support DAWs other than Ableton Live 9</li>
<li>Support creation of "superset" SoundFonts comprised of samples from more than 1 patterns</li>
<li>Replicate effects such as "lo-fi", "reverse", etc on the host machine</li>
</ol><h3>
<a name="thankscredits" class="anchor" href="#thankscredits"><span class="octicon octicon-link"></span></a>Thanks/Credits</h3>

<p><strong>Chris</strong> for sharing his Ableton knowledge and for dealing with <em>a lot</em> of broken SoundFont files. <strong>Ben Collver</strong> for placing his <a href="http://code.terrorpin.net/pysf/index">excellent Python SoundFont library, pysf</a>, in the Public Domain. <strong>Mark Conway Wirt</strong> for his MIDIUtil Python library. <strong>Mark Germani</strong> and <a href="http://www.hammersound.com/">HammerSound</a> for the "Cola" SoundFont I created my "template" SoundFont from. <strong>EnjoyPA</strong> <a href="https://www.freesound.org/people/EnjoyPA/">on FreeSound.org</a> for the WAVs I used in the "template".</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">ptn2midi maintained by <a href="https://github.com/TylerOderkirk">TylerOderkirk</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-50714982-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
